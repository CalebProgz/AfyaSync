<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Calculator - AfyaSync</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-blue-600 text-white">
            <div class="p-6">
                <h1 class="text-2xl font-bold mb-8">AfyaSync</h1>
                <nav>
                    <ul class="space-y-4">
                        <li>
                            <a href="/api/HomePage.html" class="flex items-center px-4 py-3 hover:bg-blue-700 rounded-lg">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <button onclick="goToBMI()" class="flex items-center w-full px-4 py-3 bg-blue-700 rounded-lg transition-colors">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                </svg>
                                BMI Calculator
                            </button>
                        </li>
                        <li>
                            <a href="/api/EditProfile.html">
                            <button onclick="editDetails()" class="flex items-center w-full px-4 py-3 hover:bg-blue-700 rounded-lg transition-colors">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                Edit Profile
                            </button>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <!-- Top Navigation Bar -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-8 py-4">
                    <h1 class="text-2xl font-semibold text-gray-800">BMI Calculator</h1>
                    <div class="flex items-center space-x-4">
                        <button class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                        </button>
                        <a href="/api/logout" class="inline">
                            <button type="button" class="flex items-center px-4 py-2 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                                Logout
                            </button>
                        </a>
                    </div>
                </div>
            </header>

            <!-- BMI Calculator Content -->
            <div class="p-8">
                <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
                    <p class="text-gray-600 mb-6">Enter your height and weight to check your BMI</p>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Height (cm)</label>
                            <input id="height" 
                                   type="number" 
                                   min="1" 
                                   max="300"
                                   step="0.1"
                                   class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Enter height (e.g., 170)">
                            <p id="height-error" class="mt-1 text-sm text-red-600 hidden">Please enter a valid height between 1 and 300 cm</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Weight (kg)</label>
                            <input id="weight" 
                                   type="number"
                                   min="1"
                                   max="500"
                                   step="0.1"
                                   class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Enter weight (e.g., 70)">
                            <p id="weight-error" class="mt-1 text-sm text-red-600 hidden">Please enter a valid weight between 1 and 500 kg</p>
                        </div>

                        <button onclick="calculateBMI()" 
                                class="w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Calculate BMI
                        </button>

                        <!-- Adding spacing between the Calculate BMI and the scale -->
                    <div id="" class="hidden mt-12"></div>
                    </div>
                        
                        <div id="bmi-scale" class="hidden mt-6">
                            <div class="h-4 rounded-full flex">
                                <div class="w-1/4 bg-blue-400 rounded-l-full relative" title="Underweight">
                                    <span class="absolute -top-6 left-0 text-xs text-gray-600">Underweight</span>
                                </div>
                                <div class="w-1/4 bg-green-400 relative" title="Normal">
                                    <span class="absolute -top-6 left-0 text-xs text-gray-600">Normal</span>
                                </div>
                                <div class="w-1/4 bg-yellow-400 relative" title="Overweight">
                                    <span class="absolute -top-6 left-0 text-xs text-gray-600">Overweight</span>
                                </div>
                                <div class="w-1/4 bg-red-400 rounded-r-full relative" title="Obese">
                                    <span class="absolute -top-6 left-0 text-xs text-gray-600">Obese</span>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>16</span>
                                <span>18.5</span>
                                <span>25</span>
                                <span>30</span>
                                <span>40</span>
                            </div>
                            <div id="bmi-marker" class="relative h-6 w-2 -mt-8 hidden" style="transition: left 0.3s ease-in-out;"></div>
                        </div>

                        <div id="result" class="mt-4 text-lg font-semibold text-gray-700"></div>
                        <p id="advice" class="mt-2 text-gray-600"></p>

                        <div id="health-tips" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                            <h3 class="font-semibold text-gray-800 mb-2">Health Tips:</h3>
                            <ul id="tips-list" class="list-disc list-inside text-gray-600 space-y-2">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function goToBMI() {
            window.location.href = "/api/BMI.html";
        }
        
        function editDetails() {
            window.location.href = "/api/EditProfile.html";
        }

        function calculateBMI() {
            document.getElementById('height-error').classList.add('hidden');
            document.getElementById('weight-error').classList.add('hidden');

            let height = document.getElementById('height').value;
            let weight = document.getElementById('weight').value;

            if (!isValidInput(height, 1, 300)) {
                document.getElementById('height-error').classList.remove('hidden');
                return;
            }
            if (!isValidInput(weight, 1, 500)) {
                document.getElementById('weight-error').classList.remove('hidden');
                return;
            }

            height = height / 100;
            let bmi = (weight / (height * height)).toFixed(1);
            
            document.getElementById('bmi-scale').classList.remove('hidden');
            
            updateBMIMarker(bmi);
            
            let resultText = `Your BMI is: ${bmi}`;
            let advice = getBMIAdvice(bmi);
            let tips = getHealthTips(bmi);
            
            document.getElementById('result').innerText = resultText;
            document.getElementById('advice').innerText = advice;
            
            const healthTipsDiv = document.getElementById('health-tips');
            const tipsList = document.getElementById('tips-list');
            healthTipsDiv.classList.remove('hidden');
            tipsList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
        }

        function isValidInput(value, min, max) {
            return value && !isNaN(value) && value >= min && value <= max;
        }

        function updateBMIMarker(bmi) {
            const marker = document.getElementById('bmi-marker');
            const scale = document.getElementById('bmi-scale');
            const scaleWidth = scale.offsetWidth;
            
            // Define BMI ranges more precisely
            const minBMI = 16;
            const maxBMI = 40;
            const ranges = {
                underweight: { min: 16, max: 18.5 },
                normal: { min: 18.5, max: 25 },
                overweight: { min: 25, max: 30 },
                obese: { min: 30, max: 40 }
            };
            
            // Clamp BMI value to our scale range
            const clampedBMI = Math.max(minBMI, Math.min(maxBMI, bmi));
            
            // Calculate position with improved precision
            let position;
            if (clampedBMI < ranges.underweight.max) {
                // Underweight zone (first quarter)
                const rangeWidth = scaleWidth / 4;
                const rangeProgress = (clampedBMI - ranges.underweight.min) / (ranges.underweight.max - ranges.underweight.min);
                position = rangeWidth * rangeProgress;
            } else if (clampedBMI < ranges.normal.max) {
                // Normal zone (second quarter)
                const rangeWidth = scaleWidth / 4;
                const rangeProgress = (clampedBMI - ranges.normal.min) / (ranges.normal.max - ranges.normal.min);
                position = rangeWidth + (rangeWidth * rangeProgress);
            } else if (clampedBMI < ranges.overweight.max) {
                // Overweight zone (third quarter)
                const rangeWidth = scaleWidth / 4;
                const rangeProgress = (clampedBMI - ranges.overweight.min) / (ranges.overweight.max - ranges.overweight.min);
                position = (2 * rangeWidth) + (rangeWidth * rangeProgress);
            } else {
                // Obese zone (fourth quarter)
                const rangeWidth = scaleWidth / 4;
                const rangeProgress = (clampedBMI - ranges.obese.min) / (ranges.obese.max - ranges.obese.min);
                position = (3 * rangeWidth) + (rangeWidth * rangeProgress);
            }

            // Update marker position and add transition for smooth movement
            marker.style.transition = 'left 0.3s ease-in-out';
            marker.style.left = `${position}px`;
            marker.classList.remove('hidden');
            
            // Add BMI value tooltip to marker
            marker.title = `BMI: ${bmi}`;
            
            // Update marker color based on BMI range
            if (bmi < 18.5) {
                marker.style.backgroundColor = '#60A5FA'; // blue-400
            } else if (bmi < 25) {
                marker.style.backgroundColor = '#34D399'; // green-400
            } else if (bmi < 30) {
                marker.style.backgroundColor = '#FBBF24'; // yellow-400
            } else {
                marker.style.backgroundColor = '#F87171'; // red-400
            }
        }

        function getBMIAdvice(bmi) {
            if (bmi < 18.5) {
                return "You are underweight. Consider consulting a healthcare provider about a balanced diet plan.";
            } else if (bmi >= 18.5 && bmi < 24.9) {
                return "Your weight is normal. Keep maintaining a healthy lifestyle!";
            } else if (bmi >= 25 && bmi < 30) {
                return "You are overweight. A combination of regular exercise and a balanced, calorie-controlled diet can help you reach a healthy weight.";
            } else if(bmi >= 30 && bmi < 40) {
                return "You are in the obese range. Please consult a healthcare provider for personalized advice.";
            } else{
                return "You are in the obese range. Please consult a healthcare provider for personalized advice.";
            }
        }

        function getHealthTips(bmi) {
            const commonTips = [
                "Stay hydrated by drinking plenty of water",
                "Get 7-9 hours of sleep each night",
                "Exercise regularly, aim for 150 minutes per week"
            ];

            if (bmi < 18.5) {
                return [
                    "Increase your caloric intake with nutrient-rich foods",
                    "Include protein-rich foods in every meal",
                    "Consider strength training exercises",
                    ...commonTips
                ];
            } else if (bmi >= 18.5 && bmi < 24.9) {
                return [
                    "Maintain your balanced diet",
                    "Mix cardio and strength training",
                    "Keep tracking your BMI periodically",
                    ...commonTips
                ];
            } else if (bmi >= 25 && bmi < 30) {
                return [
                    "Create a moderate calorie deficit (500 calories less per day)",
                    "Include 30 minutes of moderate exercise daily",
                    "Focus on whole grains and lean proteins",
                    "Increase fiber intake through vegetables and fruits",
                    "Monitor portion sizes during meals",
                    "Consider keeping a food diary",
                    "Try to reduce processed food intake",
                    ...commonTips
                ];
            } else {
                return [
                    "Focus on portion control",
                    "Include more fruits and vegetables in your diet",
                    "Start with low-impact exercises",
                    "Track your daily caloric intake",
                    "Consider consulting a nutritionist",
                    ...commonTips
                ];
            }
        }
    </script>
</body>
</html>
